# Snyk - Results Exploitation

## 1. Exploiting SCA Results (Dependencies)

### File: `snyk-sca-results.json`

This file contains all vulnerabilities found in project dependencies (Python, npm, etc.).

### File Structure

```json
{
  "vulnerabilities": [
    {
      "id": "SNYK-PYTHON-REQUESTS-12345",
      "title": "Prototype Pollution",
      "severity": "high",
      "packageName": "requests",
      "version": "2.25.0",
      "fixedIn": ["2.31.0"],
      "cvssScore": 7.4,
      "exploit": "Proof of Concept",
      "isPatchable": true,
      "upgradePath": ["requests@2.31.0"]
    }
  ],
  "summary": {
    "critical": 2,
    "high": 15,
    "medium": 45,
    "low": 12
  }
}
```

### Analysis Commands

```bash
cd Scanner/Snyk/scan_results/

# 1. View vulnerability summary by severity
cat snyk-sca-results.json | jq '.summary'

# Example output:
# {
#   "critical": 2,
#   "high": 15,
#   "medium": 45,
#   "low": 12
# }

# 2. List all critical vulnerabilities
cat snyk-sca-results.json | jq '.vulnerabilities[] | select(.severity == "critical") | {package: .packageName, version: .version, title: .title, fix: .fixedIn}'

# 3. List patchable vulnerabilities (with fix available)
cat snyk-sca-results.json | jq '.vulnerabilities[] | select(.isPatchable == true) | {package: .packageName, current: .version, fixed: .fixedIn, severity: .severity}'

# 4. Top 5 most vulnerable packages
cat snyk-sca-results.json | jq '[.vulnerabilities[] | .packageName] | group_by(.) | map({package: .[0], count: length}) | sort_by(.count) | reverse | .[0:5]'

# 5. Vulnerabilities with known exploit (high priority)
cat snyk-sca-results.json | jq '.vulnerabilities[] | select(.exploit != "Not Defined" and .exploit != null) | {package: .packageName, title: .title, exploit: .exploit, severity: .severity}'
```

### SCA Prioritization

| Priority | Criteria | Action |
|----------|----------|--------|
| 游댮 **CRITICAL** | Severity: Critical + Known exploit | Immediate fix |
| 游 **HIGH** | Severity: High + Patchable | Fix within 48h |
| 游리 **MEDIUM** | Severity: Medium + Patchable | Schedule fix |
| 游릭 **LOW** | Severity: Low | Monitor |

---

## 2. Exploiting SAST Results (Source Code)

### File: `snyk-sast-results.json`

This file contains vulnerabilities detected in source code (SARIF format).

### File Structure

```json
{
  "runs": [{
    "results": [
      {
        "ruleId": "python/SqlInjection",
        "level": "error",
        "message": {
          "text": "Unsanitized input from request is used in SQL query"
        },
        "locations": [{
          "physicalLocation": {
            "artifactLocation": {
              "uri": "backend/api/users.py"
            },
            "region": {
              "startLine": 45,
              "startColumn": 12
            }
          }
        }],
        "cwe": ["CWE-89"]
      }
    ]
  }]
}
```

### Analysis Commands

```bash
cd Scanner/Snyk/scan_results/

# 1. Count issues by severity
cat snyk-sast-results.json | jq '[.runs[].results[] | .level] | group_by(.) | map({severity: .[0], count: length})'

# Example:
# [
#   {"severity": "error", "count": 5},
#   {"severity": "warning", "count": 12},
#   {"severity": "note", "count": 8}
# ]

# 2. List all critical issues (error level)
cat snyk-sast-results.json | jq '.runs[].results[] | select(.level == "error") | {rule: .ruleId, file: .locations[0].physicalLocation.artifactLocation.uri, line: .locations[0].physicalLocation.region.startLine, message: .message.text}'

# 3. Group by file (most problematic files)
cat snyk-sast-results.json | jq '[.runs[].results[] | .locations[0].physicalLocation.artifactLocation.uri] | group_by(.) | map({file: .[0], issues: length}) | sort_by(.issues) | reverse'

# 4. Filter by vulnerability type (e.g., SQL Injection)
cat snyk-sast-results.json | jq '.runs[].results[] | select(.ruleId | contains("SqlInjection")) | {file: .locations[0].physicalLocation.artifactLocation.uri, line: .locations[0].physicalLocation.region.startLine}'

# 5. List all detected rules
cat snyk-sast-results.json | jq '[.runs[].results[] | .ruleId] | unique'
```

### SAST Prioritization

| Priority | Level | Vulnerability Type | Action |
|----------|-------|-------------------|--------|
| 游댮 **CRITICAL** | error | SQL Injection, XSS, Command Injection | Immediate fix |
| 游 **HIGH** | error | Hardcoded secrets, Path Traversal | Fix within 48h |
| 游리 **MEDIUM** | warning | Insecure crypto, Missing auth | Schedule fix |
| 游릭 **LOW** | note | Code smells, Best practices | Review |

---

## 3. Exploiting Container Results (Docker Images)

### Files: `snyk-container-backend-results.json` & `snyk-container-frontend-results.json`

These files contain vulnerabilities in Docker images (OS packages, base image).

### File Structure

```json
{
  "vulnerabilities": [
    {
      "id": "SNYK-DEBIAN11-OPENSSL-2947032",
      "title": "CVE-2023-0215: Use After Free",
      "severity": "high",
      "packageName": "openssl",
      "version": "1.1.1n-0+deb11u3",
      "fixedIn": ["1.1.1n-0+deb11u4"],
      "nvdSeverity": "high",
      "exploit": "Not Defined"
    }
  ],
  "baseImageRemediation": {
    "message": "Upgrade base image python:3.11-slim to python:3.11-slim-bookworm",
    "advice": "Use newer base image to reduce vulnerabilities"
  }
}
```

### Analysis Commands

```bash
cd Scanner/Snyk/scan_results/

# 1. View base image recommendations
cat snyk-container-backend-results.json | jq '.baseImageRemediation'

# 2. Critical vulnerabilities in image
cat snyk-container-backend-results.json | jq '.vulnerabilities[] | select(.severity == "critical" or .severity == "high") | {package: .packageName, version: .version, severity: .severity, fix: .fixedIn}'

# 3. Compare backend vs frontend
echo "Backend:" && cat snyk-container-backend-results.json | jq '{critical: [.vulnerabilities[] | select(.severity == "critical")] | length, high: [.vulnerabilities[] | select(.severity == "high")] | length}'
echo "Frontend:" && cat snyk-container-frontend-results.json | jq '{critical: [.vulnerabilities[] | select(.severity == "critical")] | length, high: [.vulnerabilities[] | select(.severity == "high")] | length}'

# 4. Vulnerable OS packages (top 10)
cat snyk-container-backend-results.json | jq '[.vulnerabilities[] | .packageName] | group_by(.) | map({package: .[0], count: length}) | sort_by(.count) | reverse | .[0:10]'
```

### Container Prioritization

| Priority | Action | Effort |
|----------|--------|--------|
| 游댮 **Outdated base image** | Upgrade to recommended image | 2-4h |
| 游 **Critical OS vulns** | Rebuild image with updates | 1-2h |
| 游리 **High patchable vulns** | Update packages in Dockerfile | 30min-1h |
| 游릭 **Monitoring** | Watch for new CVEs | Continuous |

---

## 4. Generating Consolidated Reports

### Create Excel/CSV Report

```bash
# Export CSV of critical/high vulnerabilities
cat snyk-sca-results.json | jq -r '.vulnerabilities[] | select(.severity == "critical" or .severity == "high") | [.packageName, .version, .severity, .title, .fixedIn[0]] | @csv' > vulnerabilities-high-critical.csv

# Open in Excel or Google Sheets
open vulnerabilities-high-critical.csv
```

### Summary Dashboard

```bash
# Create global summary
echo "=== Snyk Security Scan Results ===" > security-summary.txt
echo "" >> security-summary.txt
echo "SCA (Dependencies):" >> security-summary.txt
cat snyk-sca-results.json | jq '.summary' >> security-summary.txt
echo "" >> security-summary.txt
echo "SAST (Code Analysis):" >> security-summary.txt
cat snyk-sast-results.json | jq '[.runs[].results[] | .level] | group_by(.) | map({level: .[0], count: length})' >> security-summary.txt
echo "" >> security-summary.txt
cat security-summary.txt
```

---

## 5. Action Plan Template

After analyzing results, follow this plan:

### Week 1: Emergencies

- [ ] Fix all **Critical** vulnerabilities with known exploits (SCA)
- [ ] Fix all **error level** SAST vulnerabilities (SQL Injection, XSS)
- [ ] Upgrade Docker base images if recommended

### Week 2-3: Priority Fixes

- [ ] Fix **High** patchable vulnerabilities (SCA)
- [ ] Fix critical **warning level** SAST issues
- [ ] Rebuild Docker images with OS updates

### Week 4+: Continuous Improvement

- [ ] Schedule **Medium** severity fixes
- [ ] Set up continuous monitoring (`snyk monitor`)
- [ ] Integrate Snyk into CI/CD pipeline
- [ ] Train team on identified best practices

---

## 6. Continuous Monitoring

### Send Results to Snyk Dashboard

```bash
cd keiken-dragon-ai
snyk monitor --all-projects --project-name="dragon-develop"
```

Access dashboard: https://app.snyk.io/

### Configure Alerts

1. Go to https://app.snyk.io/org/YOUR_ORG/manage/settings
2. Configure:
   - Email alerts for new critical vulnerabilities
   - Webhooks for Slack/Teams integration
   - Weekly security reports

---