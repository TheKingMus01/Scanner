# Snyk - R√©cup√©ration & Exploitation des R√©sultats

---

## üìÅ Structure des R√©sultats

Apr√®s avoir ex√©cut√© les scans, les r√©sultats sont sauvegard√©s dans `Scanner/Snyk/scan_results/` :

```
scan_results/
‚îú‚îÄ‚îÄ snyk-sca-results.json           # Vuln√©rabilit√©s des d√©pendances (SCA)
‚îú‚îÄ‚îÄ snyk-sast-results.json          # Vuln√©rabilit√©s du code source (SAST)
‚îú‚îÄ‚îÄ snyk-container-frontend-results.json  # Vuln√©rabilit√©s image Docker frontend
‚îú‚îÄ‚îÄ snyk-container-backend-results.json   # Vuln√©rabilit√©s image Docker backend (si disponible)
‚îî‚îÄ‚îÄ snyk-report-*.txt               # Rapports texte lisibles
```

---

## üì• 1. R√©cup√©ration des R√©sultats

### V√©rifier que les scans sont termin√©s

```bash
# Voir la taille des fichiers de r√©sultats
ls -lh Scanner/Snyk/scan_results/

# Un fichier JSON vide (0B) = scan √©chou√©
# Un fichier JSON > 1KB = scan r√©ussi
```

### Copier les r√©sultats depuis le serveur de scan (si distant)

```bash
# Si les scans ont √©t√© ex√©cut√©s sur un serveur distant
scp user@server:/path/to/keiken-dragon-ai/../Scanner/Snyk/scan_results/*.json ./local-results/
```

---

## üîç 2. Exploitation des R√©sultats SCA (D√©pendances)

### Fichier : `snyk-sca-results.json`

Ce fichier contient toutes les vuln√©rabilit√©s trouv√©es dans les d√©pendances du projet (Python, npm, etc.).

### Structure du fichier

```json
{
  "vulnerabilities": [
    {
      "id": "SNYK-PYTHON-REQUESTS-12345",
      "title": "Prototype Pollution",
      "severity": "high",
      "packageName": "requests",
      "version": "2.25.0",
      "fixedIn": ["2.31.0"],
      "cvssScore": 7.4,
      "exploit": "Proof of Concept",
      "isPatchable": true,
      "upgradePath": ["requests@2.31.0"]
    }
  ],
  "summary": {
    "critical": 2,
    "high": 15,
    "medium": 45,
    "low": 12
  }
}
```

### Commandes d'analyse

```bash
cd Scanner/Snyk/scan_results/

# 1. Voir le r√©sum√© des vuln√©rabilit√©s par s√©v√©rit√©
cat snyk-sca-results.json | jq '.summary'

# Exemple de sortie :
# {
#   "critical": 2,
#   "high": 15,
#   "medium": 45,
#   "low": 12
# }

# 2. Lister toutes les vuln√©rabilit√©s critiques
cat snyk-sca-results.json | jq '.vulnerabilities[] | select(.severity == "critical") | {package: .packageName, version: .version, title: .title, fix: .fixedIn}'

# 3. Lister les vuln√©rabilit√©s patchables (avec fix disponible)
cat snyk-sca-results.json | jq '.vulnerabilities[] | select(.isPatchable == true) | {package: .packageName, current: .version, fixed: .fixedIn, severity: .severity}'

# 4. Top 5 packages les plus vuln√©rables
cat snyk-sca-results.json | jq '[.vulnerabilities[] | .packageName] | group_by(.) | map({package: .[0], count: length}) | sort_by(.count) | reverse | .[0:5]'

# 5. Vuln√©rabilit√©s avec exploit connu (priorit√© haute)
cat snyk-sca-results.json | jq '.vulnerabilities[] | select(.exploit != "Not Defined" and .exploit != null) | {package: .packageName, title: .title, exploit: .exploit, severity: .severity}'
```

### Priorisation SCA

| Priorit√© | Crit√®res | Action |
|----------|----------|--------|
| üî¥ **CRITIQUE** | S√©v√©rit√©: Critical + Exploit connu | Fix imm√©diat |
| üü† **HAUTE** | S√©v√©rit√©: High + Patchable | Fix dans 48h |
| üü° **MOYENNE** | S√©v√©rit√©: Medium + Patchable | Planifier fix |
| üü¢ **BASSE** | S√©v√©rit√©: Low | Monitorer |

---

## üîí 3. Exploitation des R√©sultats SAST (Code Source)

### Fichier : `snyk-sast-results.json`

Ce fichier contient les vuln√©rabilit√©s d√©tect√©es dans le code source (format SARIF).

### Structure du fichier

```json
{
  "runs": [{
    "results": [
      {
        "ruleId": "python/SqlInjection",
        "level": "error",
        "message": {
          "text": "Unsanitized input from request is used in SQL query"
        },
        "locations": [{
          "physicalLocation": {
            "artifactLocation": {
              "uri": "backend/api/users.py"
            },
            "region": {
              "startLine": 45,
              "startColumn": 12
            }
          }
        }],
        "cwe": ["CWE-89"]
      }
    ]
  }]
}
```

### Commandes d'analyse

```bash
cd Scanner/Snyk/scan_results/

# 1. Compter les probl√®mes par s√©v√©rit√©
cat snyk-sast-results.json | jq '[.runs[].results[] | .level] | group_by(.) | map({severity: .[0], count: length})'

# Exemple :
# [
#   {"severity": "error", "count": 5},
#   {"severity": "warning", "count": 12},
#   {"severity": "note", "count": 8}
# ]

# 2. Lister tous les probl√®mes critiques (error level)
cat snyk-sast-results.json | jq '.runs[].results[] | select(.level == "error") | {rule: .ruleId, file: .locations[0].physicalLocation.artifactLocation.uri, line: .locations[0].physicalLocation.region.startLine, message: .message.text}'

# 3. Grouper par fichier (fichiers les plus probl√©matiques)
cat snyk-sast-results.json | jq '[.runs[].results[] | .locations[0].physicalLocation.artifactLocation.uri] | group_by(.) | map({file: .[0], issues: length}) | sort_by(.issues) | reverse'

# 4. Filtrer par type de vuln√©rabilit√© (ex: SQL Injection)
cat snyk-sast-results.json | jq '.runs[].results[] | select(.ruleId | contains("SqlInjection")) | {file: .locations[0].physicalLocation.artifactLocation.uri, line: .locations[0].physicalLocation.region.startLine}'

# 5. Lister toutes les r√®gles d√©tect√©es
cat snyk-sast-results.json | jq '[.runs[].results[] | .ruleId] | unique'
```

### Priorisation SAST

| Priorit√© | Level | Type de vuln√©rabilit√© | Action |
|----------|-------|----------------------|--------|
| üî¥ **CRITIQUE** | error | SQL Injection, XSS, Command Injection | Fix imm√©diat |
| üü† **HAUTE** | error | Hardcoded secrets, Path Traversal | Fix sous 48h |
| üü° **MOYENNE** | warning | Insecure crypto, Missing auth | Planifier fix |
| üü¢ **BASSE** | note | Code smells, Best practices | Review |

---

## üê≥ 4. Exploitation des R√©sultats Container (Images Docker)

### Fichiers : `snyk-container-backend-results.json` & `snyk-container-frontend-results.json`

Ces fichiers contiennent les vuln√©rabilit√©s des images Docker (packages OS, base image).

### Structure du fichier

```json
{
  "vulnerabilities": [
    {
      "id": "SNYK-DEBIAN11-OPENSSL-2947032",
      "title": "CVE-2023-0215: Use After Free",
      "severity": "high",
      "packageName": "openssl",
      "version": "1.1.1n-0+deb11u3",
      "fixedIn": ["1.1.1n-0+deb11u4"],
      "nvdSeverity": "high",
      "exploit": "Not Defined"
    }
  ],
  "baseImageRemediation": {
    "message": "Upgrade base image python:3.11-slim to python:3.11-slim-bookworm",
    "advice": "Use newer base image to reduce vulnerabilities"
  }
}
```

### Commandes d'analyse

```bash
cd Scanner/Snyk/scan_results/

# 1. Voir les recommandations de base image
cat snyk-container-backend-results.json | jq '.baseImageRemediation'

# 2. Vuln√©rabilit√©s critiques dans l'image
cat snyk-container-backend-results.json | jq '.vulnerabilities[] | select(.severity == "critical" or .severity == "high") | {package: .packageName, version: .version, severity: .severity, fix: .fixedIn}'

# 3. Comparer backend vs frontend
echo "Backend:" && cat snyk-container-backend-results.json | jq '{critical: [.vulnerabilities[] | select(.severity == "critical")] | length, high: [.vulnerabilities[] | select(.severity == "high")] | length}'
echo "Frontend:" && cat snyk-container-frontend-results.json | jq '{critical: [.vulnerabilities[] | select(.severity == "critical")] | length, high: [.vulnerabilities[] | select(.severity == "high")] | length}'

# 4. Packages OS vuln√©rables (top 10)
cat snyk-container-backend-results.json | jq '[.vulnerabilities[] | .packageName] | group_by(.) | map({package: .[0], count: length}) | sort_by(.count) | reverse | .[0:10]'
```

### Priorisation Container

| Priorit√© | Action | Effort |
|----------|--------|--------|
| üî¥ **Base image obsol√®te** | Upgrader vers image recommand√©e | 2-4h |
| üü† **Vulns critiques OS** | Rebuild image avec updates | 1-2h |
| üü° **Vulns high patchables** | Update packages dans Dockerfile | 30min-1h |
| üü¢ **Monitoring** | Surveiller nouvelles CVE | Continu |

---

## üìä 5. G√©n√©ration de Rapports Consolid√©s

### Cr√©er un rapport Excel/CSV

```bash
# Export CSV des vuln√©rabilit√©s critiques/high
cat snyk-sca-results.json | jq -r '.vulnerabilities[] | select(.severity == "critical" or .severity == "high") | [.packageName, .version, .severity, .title, .fixedIn[0]] | @csv' > vulnerabilities-high-critical.csv

# Ouvrir dans Excel ou Google Sheets
open vulnerabilities-high-critical.csv
```

### Dashboard de synth√®se

```bash
# Cr√©er un r√©sum√© global
echo "=== Snyk Security Scan Results ===" > security-summary.txt
echo "" >> security-summary.txt
echo "SCA (Dependencies):" >> security-summary.txt
cat snyk-sca-results.json | jq '.summary' >> security-summary.txt
echo "" >> security-summary.txt
echo "SAST (Code Analysis):" >> security-summary.txt
cat snyk-sast-results.json | jq '[.runs[].results[] | .level] | group_by(.) | map({level: .[0], count: length})' >> security-summary.txt
echo "" >> security-summary.txt
cat security-summary.txt
```

---

## üéØ 6. Plan d'Action Type

Apr√®s avoir analys√© les r√©sultats, suivez ce plan :

### Semaine 1 : Urgences

- [ ] Fixer toutes les vuln√©rabilit√©s **Critical** avec exploit connu (SCA)
- [ ] Corriger toutes les vuln√©rabilit√©s **error level** SAST (SQL Injection, XSS)
- [ ] Upgrader les base images Docker si recommand√©

### Semaine 2-3 : Corrections prioritaires

- [ ] Fixer les vuln√©rabilit√©s **High** patchables (SCA)
- [ ] Corriger les **warning level** SAST critiques
- [ ] Rebuild images Docker avec mises √† jour OS

### Semaine 4+ : Am√©lioration continue

- [ ] Planifier fix des **Medium** severity
- [ ] Mettre en place monitoring continu (`snyk monitor`)
- [ ] Int√©grer Snyk dans CI/CD pipeline
- [ ] Former l'√©quipe sur les bonnes pratiques identifi√©es

---

## üîÑ 7. Monitoring Continu

### Envoyer les r√©sultats vers Snyk Dashboard

```bash
cd keiken-dragon-ai
snyk monitor --all-projects --project-name="dragon-develop"
```

Acc√©der au dashboard : https://app.snyk.io/

### Configurer les alertes

1. Aller sur https://app.snyk.io/org/YOUR_ORG/manage/settings
2. Configurer :
   - Email alerts pour nouvelles vuln√©rabilit√©s critiques
   - Webhooks pour int√©gration Slack/Teams
   - Weekly security reports

---

## üìö Ressources Compl√©mentaires

- [Snyk Documentation](https://docs.snyk.io/)
- [CWE Database](https://cwe.mitre.org/) - R√©f√©rence des types de vuln√©rabilit√©s
- [CVE Details](https://www.cvedetails.com/) - D√©tails sur les CVE
- [OWASP Top 10](https://owasp.org/www-project-top-ten/) - Top vuln√©rabilit√©s web
- [CVSS Calculator](https://www.first.org/cvss/calculator/3.1) - Calculer le score CVSS
